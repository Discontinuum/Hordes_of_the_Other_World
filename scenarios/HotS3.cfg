#textdomain wesnoth-hotow
[scenario]
    id=Shadowlord_fortress
    name= _ "Fortress of Ultimate Darkness"
    description= _ "A fancy description."
    turns="-1"
    experience_modifier="60"
    map_data="{~add-ons/Hordes_of_the_Other_World/maps/HotS3.map}"
    victory_when_enemies_defeated=no
    fog=no
    {SCENARIO_MUSIC "suspense.ogg"}
    {EXTRA_SCENARIO_MUSIC "into_the_shadows.ogg"}
    {EXTRA_SCENARIO_MUSIC "knalgan_theme.ogg"}
    {EXTRA_SCENARIO_MUSIC "the_deep_path.ogg"}
    {EXTRA_SCENARIO_MUSIC "harp.ogg"}
    {EXTRA_SCENARIO_MUSIC "vengeful.ogg"}
    {UNDERGROUND}
    [time_area]
        x=0-6
        y=21-81
        {SCHEDULE_HELL}
    [/time_area]
    [time_area]
        x=5-25
        y=23-82
        {SCHEDULE_HELL}
    [/time_area]
    [time_area]
        x=26-38
        y=19-81
        {SCHEDULE_HELL}
    [/time_area]
    [time_area]
        x=37-53
        y=22-81
        {SCHEDULE_HELL}
    [/time_area]
    [time_area]
        x=52-54
        y=54-66
        {SCHEDULE_HELL}
    [/time_area]
    [time_area]
        x=55
        y=52-53
        {SCHEDULE_HELL}
    [/time_area]
    [time_area]
        x=52-56
        y=23-55
        {SCHEDULE_HELL}
    [/time_area]
    [time_area]
        x=56
        y=26-30
        {SCHEDULE_HELL}
    [/time_area]
    [time_area]
        x=57
        y=28-29
        {SCHEDULE_HELL}
    [/time_area]
    [side]
        side=1
        id=Efraim
        type=Efraim_lich
        gender=male
        canrecruit=yes
        team_name="heroes"
        user_team_name= _ "teamname^Heroes"
        controller="human"
        save_id="Efraim"
        name=_"Efraim"
        description= _ "Efraim and his skeletal hordes"
        recruit=Walking Corpse,Ghost,Skeleton Archer,Skeleton,Dark Adept
        faction=Custom
        faction_lock=yes
        leader_lock=yes
        team_lock=yes
        village_gold=0
        gold=0
        color=red
        income=-2
        gold_lock="true"
        income_lock="true"
        team_lock="true"
        fog="yes"
        share_view="yes"
        share_maps=yes
        shroud=yes
    [/side]
    [side]
        side=2
        id=Lethalia
        canrecruit=yes
        team_name="heroes"
        type=Lethalia_lich
        user_team_name= _ "teamname^Heroes"
        controller="human"
        save_id="Lethalia"
        name=_"Lethalia"
        description= _ "Lethalia and her loyal elves"
        recruit=Elvish Archer,Elvish Fighter,Elvish Scout,Elvish Shaman
        faction=Custom
        faction_lock=yes
        leader_lock=yes
        team_lock=yes
        village_gold=0
        color=blue
        gold=0
        income=-2
        gold_lock="true"
        income_lock="true"
        team_lock="true"
        fog="yes"
        share_view="yes"
        share_maps=yes
        shroud=yes
    [/side]
    [side]
        side=3
        id=Argan
        type=Argan_lich
        canrecruit=yes
        team_name="heroes"
        user_team_name= _ "teamname^Heroes"
        controller="human"
        save_id="Argan"
        name=_"Argan"
        description= _ "Argan and his army"
        recruit=Cavalryman,Spearman,Heavy Infantryman,Bowman
        faction=Custom
        faction_lock=yes
        leader_lock=yes
        team_lock=yes
        village_gold=0
        gold=0
        color=green
        income=-2
        gold_lock="true"
        income_lock="true"
        team_lock="true"
        fog="yes"
        share_view="yes"
        share_maps=yes
        shroud=yes
    [/side]
    [side]
        side=4
        id=Stormrider
        type=Stormrider
        canrecruit=yes
        team_name="heroes"
        user_team_name= _ "teamname^Heroes"
        controller="human"
        save_id="Stormrider"
        name=_"Stormrider"
        description= _ "Stormrider and his noble army"
        recruit=Horseman,Fencer,Mage,Sergeant
        faction=Custom
        faction_lock=yes
        leader_lock=yes
        team_lock=yes
        village_gold=0
        gold=0
        color=white
        income=-2
        gold_lock="true"
        income_lock="true"
        team_lock="true"
        fog="yes"
        share_view="yes"
        share_maps=yes
        shroud=yes
    [/side]
    [side]
        side=5
        id=Delly
        type=Delly_lich
        canrecruit=yes
        team_name="heroes"
        user_team_name= _ "teamname^Heroes"
        controller="human"
        save_id="Delly"
        name=_"Delly"
        description= _ "Delly and her criminal band"
        recruit=Footpad,Thief,Poacher,Thug
        faction=Custom
        faction_lock=yes
        leader_lock=yes
        team_lock=yes
        village_gold=0
        gold=0
        income=-2
        color=purple
        gold_lock="true"
        income_lock="true"
        team_lock="true"
        fog="yes"
        share_view="yes"
        share_maps=yes
        shroud=yes
    [/side]
    [side]
        side=6
        canrecruit=yes
        team_name="evil"
        user_team_name= _ "teamname^Evil"
        allow_player=no
        color=black
        faction=Custom
        gold=0
        type=Reaper
        name= _ "Harbinger of Death"
        id=Harbinger of Death
        [modifications]
            [object]
                [effect]
                    apply_to=image_mod
                    replace="CS(-255,-255,-255)"
                [/effect]
                [effect]
                    apply_to=attack
                    increase_damage=50%
                    increase_attacks=50%
                [/effect]
                [effect]
                     apply_to=hitpoints
                     increase=100%
                     increase_total=100%
                [/effect]
             [/object]
        [/modifications]
        recruit=Reaper,Deathlord,Soul Shooter,Grim Knight
        disallow_observers=yes
        controller="ai"
        village_gold=0
        income=-2
        {FLAG_VARIANT undead}
        {ENEMY_AI}
    [/side]
    [side]
        side=7
        canrecruit=yes
        team_name="evil"
        user_team_name= _ "teamname^Evil"
        allow_player=no
        color=black
        faction=Custom
        gold=0
        type=Demon Overlord
        recruit=Demon
        name= _ "Tormentor of Souls"
                    id=Tormentor of Souls
                    [modifications]
                        [trait]
                            id=brutal
                            male_name= _ "brutal"
                            female_name= _ "female^brutal"
                            [effect]
                                apply_to=attack
                                range=melee
                                [set_specials]
                                    mode=append
                                    {WEAPON_SPECIAL_LESSER_BERSERK 3}
                                [/set_specials]
                            [/effect]
                        [/trait]
                        [trait]
                            id=cruel
                            male_name= _ "cruel"
                            female_name= _ "female^cruel"
                            [effect]
                                apply_to=attack
                                range=melee
                                [set_specials]
                                    mode=append
                                    {WEAPON_SPECIAL_CHARGE}
                                [/set_specials]
                            [/effect]
                        [/trait]
                        [trait]
                            id=perverted
                            male_name= _ "perverted"
                            female_name= _ "female^perverted"
                            [effect]
                                apply_to=attack
                                range=melee
                                increase_damage=4
                            [/effect]
                        [/trait]
                    [/modifications]
        disallow_observers=yes
        controller="ai"
        village_gold=0
        income=-2
        {FLAG_VARIANT undead}
        {ENEMY_AI}
    [/side]
    [side]
        side=8
        canrecruit=yes
        team_name="evil"
        user_team_name= _ "teamname^Evil"
        allow_player=no
        color=black
        faction=Custom
        type=Dragon Rider
        name= _ "Death Overlord"
        id=Death Overlord
        recruit=Iron Mauler,Royal Guard,Necromancer,Grand Knight,Halberdier
        disallow_observers=yes
        controller="ai"
        gold=0
        village_gold=0
        income=-2
        {FLAG_VARIANT undead}
        [modifications]
                        [object]
                            [effect]
                                apply_to=image_mod
                                replace="CS(-255,-255,-255)"
                            [/effect]
                            [effect]
                                apply_to=attack
                                increase_damage=50%
                                increase_attacks=50%
                                [set_specials]
                                    mode=append
                                    {WEAPON_SPECIAL_LETHARGY}
                                [/set_specials]
                            [/effect]
                            [effect]
                                apply_to=hitpoints
                                increase=100%
                                increase_total=100%
                            [/effect]
                            [effect]
                                apply_to=max_experience
                                increase=150%
                            [/effect]
                            [effect]
                                apply_to=resistance
                                replace=false
                                [resistance]
                                    fire=-30
                                    cold=-30
                                    arcane=50
                                    blade=-30
                                    pierce=-30
                                    impact=-30
                                [/resistance]
                            [/effect]
                        [/object]
                    [/modifications]
        {ENEMY_AI}
    [/side]
    [side]
        side=9
        canrecruit=yes
        team_name="evil"
        user_team_name= _ "teamname^Evil"
        allow_player=no
        color=black
        faction=Custom
        type=Reaper
        recruit=Iron Mauler,Royal Guard,Necromancer,Grand Knight,Halberdier,Demon,Reaper,Deathlord,Grim Knight,Soul Shooter
        name= _ "Shadowlord"
                    id=Shadowlord_first
                    [modifications]
                        [object]
                            [effect]
                                apply_to=image_mod
                                replace="CS(-80,-224,-224)"
                            [/effect]
                            [effect]
                                apply_to=attack
                                increase_damage=100%
                                increase_attacks=100%
                            [/effect]
                            [effect]
                                apply_to=hitpoints
                                increase=200%
                                increase_total=200%
                            [/effect]
                            [effect]
                                apply_to=resistance
                                replace=false
                                [resistance]
                                    fire=-30
                                    cold=-30
                                    arcane=-30
                                    blade=-30
                                    pierce=-30
                                    impact=-30
                                [/resistance]
                            [/effect]
                        [/object]
                    [/modifications]
        disallow_observers=yes
        controller="ai"
        gold=0
        village_gold=0
        income=-2
        {FLAG_VARIANT undead}
        
        {ENEMY_AI}
    [/side]

    [event]
        name=prestart
        {VARIABLE quest_tracker 0}
        [objectives]
            [objective]
                description= _ "Investigate the interior of the fortress"
                condition=win
                [show_if]
                    [variable]
                        name = quest_tracker
                        equals = 0
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Defeat Shadowlord"
                condition=win
                [show_if]
                    [variable]
                        name = quest_tracker
                        equals = 1
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Proceed into the world of the dead through the portal"
                condition=win
                [show_if]
                    [variable]
                        name = quest_tracker
                        equals = 2
                    [/variable]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Optional: Find as many items and gold chests as possible"
                condition=win
            [/objective]
            [objective]
                description= _ "Defeat of any of your leaders"
                condition=lose
            [/objective]
            [note]
                description= _ "No upkeep, no income, gold can be found in chests"
            [/note]
            [note]
                description= _ "You can teleport your army to any discovered keep if there is no units near it"
            [/note]
        [/objectives]
    [/event]
    
    [event]
        name=start
        [micro_ai]
            side=6
            ai_type=fast_ai
            action=add
        [/micro_ai]
        [micro_ai]
            side=7
            ai_type=fast_ai
            action=add
        [/micro_ai]
        [micro_ai]
            side=8
            ai_type=fast_ai
            action=add
        [/micro_ai]
        [micro_ai]
            side=9
            ai_type=fast_ai
            action=add
        [/micro_ai]
                [store_unit]
                    [filter]
                        x,y=16,13
                    [/filter]
                    kill=no
                    variable=blackening_store
                [/store_unit]
                [set_variable]
                    name=blackening_store.level
                    multiply=2
                [/set_variable]
                [unstore_unit]
                    variable=blackening_store
                    find_vacant=no
                [/unstore_unit]
                [clear_variable]
                    name=blackening_store
                [/clear_variable]
        [store_unit]
                    [filter]
                        x,y=5,76
                    [/filter]
                    kill=no
                    variable=blackening_store
                [/store_unit]
                {BLACKEN}
                {RECALL_EVERYONE}
                {HOTOW_DIALOGUE "Argan" _"Argan" _"Bleah! What the hell is this place? How can something live in here? It is like..."}
                [unstore_unit]
                    variable=blackening_store
                    find_vacant=no
                [/unstore_unit]
                [clear_variable]
                    name=blackening_store
                [/clear_variable]
                [store_unit]
                    [filter]
                        id=Shadowlord_first
                    [/filter]
                    kill=no
                    variable=blackening_store
                [/store_unit]
                [set_variable]
                    name=blackening_store.level
                    value=20
                [/set_variable]
                [unstore_unit]
                    variable=blackening_store
                    find_vacant=no
                [/unstore_unit]
                [clear_variable]
                    name=blackening_store
                [/clear_variable]
        {HOTOW_DIALOGUE "Lethalia" _"Lethalia" _"Like if it was in a different world, in the world from the corruption came from. Last time I felt something like this was when we fought Lilith, but that was nothing compared to this... this... fiendish presence..."}
        [set_variables]
            name=item_list
            mode=replace
            [value]
                {ITEM_LIST}
            [/value]
        [/set_variables]


        [set_variables]
            name=spawn_list
            mode=replace
            [value]
                #ENEMY SPAWNS
                #Act3
                {A3_LESSER_BLACK_SOUL_SPAWN 42 17 6}
                {A3_LESSER_BLACK_SOUL_SPAWN 35 10 6}
                {A3_LESSER_BLACK_SOUL_SPAWN 28 15 7}
                {A3_LESSER_BLACK_SOUL_SPAWN 25 14 5}
                {A3_LESSER_BLACK_SOUL_SPAWN 18 4 6}
                {A3_LESSER_BLACK_SOUL_SPAWN 9 8 7}
                {A3_LESSER_BLACK_SOUL_SPAWN 6 15 5}
                {A3_LESSER_BLACK_SOUL_SPAWN 10 22 4}
                {A3_LESSER_BLACK_SOUL_SPAWN 11 28 6}
                {A3_DEMON_SPAWN 5 30 4}
                {A3_BLACK_SOUL_SPAWN 15 33 5}
                {A3_DEMON_SPAWN 29 33 4}
                {A3_GREATER_DEMON_SPAWN 44 34 6}
                {A3_DEMON_SPAWN 40 44 4}
                {A3_DEMON_SPAWN 41 60 3}
                {A3_GREATER_DEMON_SPAWN 30 40 6}
                {A3_BLACK_SOUL_SPAWN 6 40 4}
                {A3_DEMON_SPAWN 3 45 4}
                {A3_DEMON_SPAWN 12 60 4}
                {A3_GREATER_DEMON_SPAWN 17 67 6}
                {A3_GREATER_DEMON_SPAWN 43 65 5}
                {A3_DEMON_SPAWN 28 65 4}
                {A3_GREATER_DEMON_SPAWN 3 65 4}
                {A3_GREATER_DEMON_SPAWN 18 73 5}
                {A3_GREATER_DEMON_SPAWN 9 77 6}
                {A3_BLACK_SOUL_SPAWN 8 85 4}
                {A3_GREATER_BLACK_SOUL_SPAWN 21 89 3}
                {A3_BLACK_SOUL_SPAWN 22 88 5}
                {A3_BLACK_SOUL_SPAWN 29 90 4}
                {A3_GREATER_DEMON_SPAWN 38 89 7}
                {A3_GREATER_BLACK_SOUL_SPAWN 45 86 4}
            [/value]
        [/set_variables]
        [foreach]
            array=spawns.spawn
            [do]
                {VARIABLE spawn_list.spawn[$i].free 1}
            [/do]
        [/foreach]
        {PLACE_SPAWNS 3}


        {RARE_ITEM 3 4}
        {GOLD_CHEST 15 3}
        {RARE_ITEM 36 50}
        {GOLD_CHEST 48 61}
        {RARE_ITEM 26 75}
        {GOLD_CHEST 13 93}
        {RARE_ITEM 1 91}
        {GOLD_CHEST 33 97}
        {RARE_ITEM 34 99}#68 89 -> 34 99
        {GOLD_CHEST 32 97}
         {RARE_ITEM 26 107}
        {GOLD_CHEST 26 106}
         {RARE_ITEM 7 97}
         {GOLD_CHEST 8 96}
         {RARE_ITEM 9 97}
        {GOLD_CHEST 18 97}
        {RARE_ITEM 20 97}

    [/event]
    {KEEP_DISCOVER 16 13 _"Courtyard Entrance Keep" k31}
    {KEEP_DISCOVER 23 56 _"Courtyard Keep" k32}
    {KEEP_DISCOVER 5 76 _"Inner Fortress Entrance Keep" k33}
    {KEEP_DISCOVER 51 82 _"Shadowlord's Keep" k34}
    [event]
        name=travel
        first_time_only=no
        {VARIABLE keep_chosen 10}
        [message]
            speaker=narrator
            message= _ "Where do you want to travel?"
            image=wesnoth-icon.png
            side_for=$side_number
            [option]
                label= _ "Shadowlord's Keep"
                [show_if]
                    [variable]
                        name=k34
                        equals=1
                    [/variable]
                [/show_if]
                [command]
                    {VARIABLE keep_chosen 34}
                [/command]
            [/option]
            [option]
                label= _ "Inner Fortress Entrance Keep"
                [show_if]
                    [variable]
                        name=k33
                        equals=1
                    [/variable]
                [/show_if]
                [command]
                    {VARIABLE keep_chosen 33}
                [/command]
            [/option]
            [option]
                label= _ "Courtyard Keep"
                [show_if]
                    [variable]
                        name=k32
                        equals=1
                    [/variable]
                [/show_if]
                [command]
                    {VARIABLE keep_chosen 32}
                [/command]
            [/option]
            [option]
                label= _ "Courtyard Entrance Keep"
                [show_if]
                    [variable]
                        name=k31
                        equals=1
                    [/variable]
                [/show_if]
                [command]
                    {VARIABLE keep_chosen 31}
                [/command]
            [/option]
            [option]
                label= _ "Starting Keep"
                [command]
                    {VARIABLE keep_chosen 30}
                [/command]
            [/option]
            [option]
                label= _ "Stay here."
                [command]
                    {VARIABLE keep_chosen 0}
                [/command]
            [/option]
        [/message]
        [switch]
            variable=keep_chosen
            [case]
                value=30
                [switch]
                    variable=side_number
                    [case]
                        value=1
                        {TRAVEL_TO 50 5}
                    [/case]
                    [case]
                        value=2
                        {TRAVEL_TO 49 7}
                    [/case]
                    [case]
                        value=3
                        {TRAVEL_TO 49 4}
                    [/case]
                    [case]
                        value=4
                        {TRAVEL_TO 51 4}
                    [/case]
                    [case]
                        value=5
                        {TRAVEL_TO 51 7}
                    [/case]
                [/switch]
            [/case]
            [case]
                value=31
                {TRAVEL_TO 16 13}
            [/case]
            [case]
                value=32
                {TRAVEL_TO 23 56}
            [/case]
            [case]
                value=33
                {TRAVEL_TO 5 76}
            [/case]
            [case]
                value=34
                {TRAVEL_TO 51 82}
            [/case]
        [/switch]
    [/event]
    {HOTOW_ESSENTIALS}  
    [event]
        name=sighted

        [filter]
            race=demon-loti
        [/filter]

        [filter_second]
            side=1,2,3,4,5
        [/filter_second]
        {HOTOW_DIALOGUE Stormrider _"Stormrider" _"Oh no! You know what is that monster? It is a demon. An incarnation of pure evil. Some spirits here must possess the terrible knowledge of demonology! Revenants of times really long gone must be here. I never knew this plot was something so terrible!"}
    [/event]
    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            [filter_location]
                x,y=16,13
                radius=25
                [filter_radius]
                    terrain=!,X*,X*^*,*^X*
                [/filter_radius]
            [/filter_location]
        [/filter]
        {INCIDENTAL_MUSIC "frantic.ogg"}
        {HOTOW_DIALOGUE narrator _"Information" _"A great evil has been awakened"}
        [gold]
            side=6
            amount=$difficulty.overall
        [/gold]
    [/event]
    [event]
        name=die
        [filter]
            id=Harbinger of Death
        [/filter]
        {HOTOW_DIALOGUE "Harbinger of Death" _"Harbinger of Death" _"I will meet you again soon... and you will suffer!"}
        {QUAKE rumble.ogg}
        [redraw]
        [/redraw]
        {HOTOW_DIALOGUE Stormrider _"Stormrider" _"I have heard such unfulfillable promises before."}
    [/event]
    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            [filter_location]
                x,y=23,56
                radius=25
                [filter_radius]
                    terrain=!,X*,X*^*,*^X*
                [/filter_radius]
            [/filter_location]
        [/filter]
        {INCIDENTAL_MUSIC "frantic.ogg"}
        {HOTOW_DIALOGUE narrator _"Information" _"A great evil has been awakened"}
        {HOTOW_DIALOGUE "Tormentor of Souls" _"Tormentor of Rightful Souls" _"You, who arrive, shall have to abandon all hopes. Your souls will burn and you shall serve us for all eternity!"}
        [gold]
            side=7
            amount=$difficulty.overall
        [/gold]
    [/event]
    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            x,y=0-40,20-50
        [/filter]
        {HOTOW_DIALOGUE Stormrider _"Stormrider" _"Blood red skies, deserted rocky wasteland instead of soil, rivers of flame, eternal twilight... this place looks like Inferno... The presence of demons must have converted this courtyard into a place that looks like their world."}
    [/event]
    [event]
        name=die
        [filter]
            id=Tormentor of Souls
        [/filter]
        {HOTOW_DIALOGUE "Tormentor of Souls" _"Tormentor of Rightful Souls" _"Argh... I have failed... but I am free at last from my binding. Thank you, mortals."}
        {QUAKE rumble.ogg}
        [redraw]
        [/redraw]
        {HOTOW_DIALOGUE second_unit $second_unit.name _"The pleasure is ours. It is the first time we were not promised great revenges and terrible pain."}
    [/event]
    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            [filter_location]
                x,y=5,76
                radius=25
                [filter_radius]
                    terrain=!,X*,X*^*,*^X*
                [/filter_radius]
            [/filter_location]
        [/filter]
        {INCIDENTAL_MUSIC "frantic.ogg"}
        {HOTOW_DIALOGUE narrator _"Information" _"A great evil has been awakened"}
        [gold]
            side=8
            amount="$($difficulty.overall /3)"
        [/gold]
    [/event]
    [event]
        name=die
        [filter]
            id=Death Overlord
        [/filter]
        {HOTOW_DIALOGUE "Death Overlord" _"Death Overlord" _"Shadowlord will maul you very soon, you shall see..."}
        {QUAKE rumble.ogg}
        [redraw]
        [/redraw]
        {HOTOW_DIALOGUE second_unit $second_unit.name _"He is no match for us."}
    [/event]
    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            [filter_location]
                x,y=51,82
                radius=25
                [filter_radius]
                    terrain=!,X*,X*^*,*^X*
                [/filter_radius]
            [/filter_location]
        [/filter]
        {REPLACE_SCENARIO_MUSIC "orc_theme.ogg"}
        
        [sound]
            name=dwarf-laugh.wav
        [/sound]
        {COLOR_ADJUST -10 -10 -10}
        
        [delay]
            time=1000
        [/delay]
        {HOTOW_DIALOGUE Shadowlord_first _"Shadowlord" _"You have arrived into my keep, hidden deep inside the Fortress of Ultimate Darkness, swarming with demons and black souls... Impressive... Hrrrr.... But you I will kill you without issues, have no fear... Maybe even my pets shall suffice."}
        [delay]
            time=300
        [/delay]
        {HOTOW_DIALOGUE unit $unit.name _"Where are you hiding, fiend?"}
        [gold]
            side=9
            amount="$($difficulty.overall /3)"
        [/gold]
        {VARIABLE_OP quest_tracker add 1}
        [show_objectives]
        [/show_objectives]
    [/event]
    [event]
        name=die
        [filter]
            id=Shadowlord_first
        [/filter]
        [chat]
            speaker= _ "Shadowlord"
            message= _ "Hrrrrr. You have defeated me... for now... but this was not my strongest form... come to face me into the world of the dead, he he he... hrrrrr..."
        [/chat]
        {HOTOW_DIALOGUE Shadowlord_first _"Shadowlord" _"Hrrrrr. You have defeated me... for now... but this was not my strongest form... come to face me into the world of the dead, he he he... hrrrrr..."}
        {HOTOW_DIALOGUE narrator _"Information" _"Shadowlord has been repulsed. Portal to act 4 has been opened."}
        {QUAKE rumble.ogg}
        {QUAKE rumble.ogg}
        {REPLACE_SCENARIO_MUSIC "revelation.ogg"}
        {PLACE_IMAGE scenery/portal.png 51 84}
        {VARIABLE_OP quest_tracker add 1}
        {HOTOW_DIALOGUE Delly _"Delly" _"So it has been repulsed. Do we really need to follow it into the world of the dead? May it be a trap?"}
        {HOTOW_DIALOGUE Lethalia _"Lethalia" _"I think we have no choice. Even now the evil of this spirit is still radiating around this place. We shall destroy him for good!"}
        {HOTOW_DIALOGUE Efraim _"Efraim" _"I agree. If this spirit is so powerful, it may open a new portal and corruption will pour in our world again. We must eliminate the cause of the trouble, not just fight the symptoms."}
        {HOTOW_DIALOGUE Delly _"Delly" _"What will we encounter in the world of the dead?"}
        {HOTOW_DIALOGUE Stormrider _"Stormrider" _"Don't forget that we're not just jumping through a random portal into the world of the dead. We're heading right into the fiend's stronghold. So I expect it to swarm with black souls. And Shadowlord will be really powerful inside his stronghold."}
        {HOTOW_DIALOGUE Lethalia _"Lethalia" _"Why do black souls appear? Where could this evil grow from?"}
        {HOTOW_DIALOGUE Stormrider _"Stormrider" _"As I mentioned earlier, the Black Souls are spirits from the world of the dead that for some reason come to hate all living. Reasons may be different, it's speculated they crave for being alive again. It's not particularly known what makes someone there to become a Black Soul, it's probably a mystery of the world of the dead. Maybe there are some forces or places in the world of the dead that make suitable spirits to turn into a Black Soul."}
        {HOTOW_DIALOGUE Stormrider _"Stormrider" _"Anyway, what I can say definitely is that these spirits possess terrible power, we have already seen dreadful lethargic power of their weapons. In their quest of destruction, they have nothing to lose and are ready to use any means. We have already seen they summoned demons."}
        {HOTOW_DIALOGUE Efraim _"Efraim" _"And this Shadowlord seems to be an immensly powerful spirit who musters and commands great hordes of lesser evil spirits. It seems he possesses knowledge of demonology and probably is powerful enough to make these demons serve him, not just collaborate."}
        {HOTOW_DIALOGUE Stormrider _"Stormrider" _"Yes. He might be a powerful demon, slain long ago and turned into an extraordinary black soul. Or maybe he was a powerful wizard of ages long gone, who accumulated unholy energy since the time immemorial. It probably doesn't matter for our mission."}
        {HOTOW_DIALOGUE Efraim _"Efraim" _"Hm, I hope we won't turn into black souls when we finally end up there."}
        {HOTOW_DIALOGUE Delly _"Delly" _"Efraim, I guess we're not going to go into the world of the dead any time soon. Or... well... we're going there, but... not as... permament inhabitants."}
        [show_objectives]
        [/show_objectives]
    [/event]
    [event]
        name=moveto
        [filter]
            side=1,2,3,4,5
            x,y=51,84
        [/filter]
        first_time_only = no
        [if]
            [variable]
                name=quest_tracker
                equals=2
            [/variable]
            [then]
                {CLEAR_VARIABLE quest_tracker}
                [endlevel]
                    result=victory
                    next_scenario=Shadowlord_finale
                    carryover_percentage=100
                    carryover_add=false
                    carryover_report=no
                [/endlevel]
            [/then]
        [/if]
    [/event]
    
    #Additional constant 1 unit spawns
    [event]
        name=turn refresh
        first_time_only=no
        [if]
            [variable]
                name=difficulty.overall
                greater_than=300
            [/variable]
            [then]
                {VARIABLE spawn_chance 8}
                [if]
                    [variable]
                        name=difficulty.overall
                        greater_than=700
                    [/variable]
                    [then]
                        {VARIABLE_OP spawn_chance sub 1}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=difficulty.overall
                        greater_than=1100
                    [/variable]
                    [then]
                        {VARIABLE_OP spawn_chance sub 1}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=difficulty.overall
                        greater_than=1500
                    [/variable]
                    [then]
                        {VARIABLE_OP spawn_chance sub 1}
                    [/then]
                [/if]
                [if]
                    [variable]
                         name=difficulty.overall
                         greater_than=2200
                    [/variable]
                    [then]
                        {VARIABLE_OP spawn_chance sub 1}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=difficulty.overall
                        greater_than=3000
                    [/variable]
                    [then]
                        {VARIABLE_OP spawn_chance sub 1}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=difficulty.overall
                        greater_than=4000
                    [/variable]
                    [then]
                        {VARIABLE_OP spawn_chance sub 1}
                    [/then]
                [/if]
                [if]
                    [variable]
                        name=difficulty.overall
                        greater_than=5000
                    [/variable]
                    [then]
                        {VARIABLE_OP spawn_chance sub 1}
                    [/then]
                [/if]
                {VARIABLE_OP did_spawn rand "1..$spawn_chance"}
                [if]
                    [variable]
                        name=did_spawn
                        equals=1
                    [/variable]
                    [then]
                        {VARIABLE_OP spawn_type rand (Bowman,Spearman,Heavy Infantryman,Cavalryman,Horseman,Dark Adept)}
                        {VARIABLE_OP spawn_x rand (17..20)}
                        {VARIABLE_OP spawn_y rand (3..6)}
                        [unit]
                            type=$spawn_type
                            x,y=$spawn_x,$spawn_y
                            side=8
                            to_variable=blackening_store
                            generate_name=yes
                            random_traits=yes
                            random_gender=yes
                        [/unit]
                        {MAKE_BLACK_SOUL}
                        [clear_variable]
                            name=blackening_store
                            [/clear_variable]
                        [/then]
                [/if]
                {VARIABLE_OP did_spawn rand "1..$spawn_chance"}
                [if]
                    [variable]
                        name=did_spawn
                        equals=1
                    [/variable]
                    [then]
                        [if]
                            [variable]
                                name=difficulty.overall
                                greater_than=3500
                            [/variable]
                            [then]
                                {VARIABLE spawn_type Demon}
                            [/then]
                            [else]
                                {VARIABLE_OP spawn_type rand (Demon Warrior,Demon,Demon)}
                            [/else]
                        [/if]
                        {VARIABLE_OP spawn_x rand (31..39)}
                        {VARIABLE_OP spawn_y rand (49..54)}
                        {GENERIC_UNIT 7 $spawn_type $spawn_x $spawn_y}
                    [/then]
                [/if]
                {VARIABLE_OP did_spawn rand "1..$spawn_chance"}
                [if]
                    [variable]
                        name=did_spawn
                        equals=1
                    [/variable]
                    [then]
                        [if]
                            [variable]
                                name=difficulty.overall
                                greater_than=3700
                            [/variable]
                            [then]
                                {VARIABLE spawn_type Demon}
                            [/then]
                            [else]
                                {VARIABLE_OP spawn_type rand (Demon Warrior,Demon,Demon)}
                            [/else]
                        [/if]
                        {VARIABLE_OP spawn_x rand (22..32)}
                        {VARIABLE_OP spawn_y rand (78..86)}
                        {GENERIC_UNIT 8 $spawn_type $spawn_x $spawn_y}
                    [/then]
                [/if]
                {VARIABLE_OP did_spawn rand "1..$spawn_chance"}
                [if]
                    [variable]
                        name=did_spawn
                        equals=1
                    [/variable]
                    [then]
                        [if]
                            [variable]
                                name=difficulty.overall
                                greater_than=3800
                            [/variable]
                            [then]
                                {VARIABLE_OP spawn_type rand (Bowman,Spearman,Heavy Infantryman,Cavalryman,Horseman,Dark Adept,Longbowman,Swordsman,Javelineer,Pikeman,Shock Trooper,Dragoon,Knight,Lancer,Dark Sorcerer)}
                            [/then]
                            [else]
                                {VARIABLE_OP spawn_type rand (Bowman,Spearman,Heavy Infantryman,Cavalryman,Horseman,Dark Adept,Longbowman,Swordsman,Javelineer,Pikeman,Shock Trooper,Dragoon,Knight,Lancer,Dark Sorcerer,Master Bowman,Royal Guard,Halberdier,Grand Marshal,General,Iron Mauler,Cavalier,Grand Knight,Necromancer)}
                            [/else]
                        [/if]
                        {VARIABLE_OP spawn_x rand (36..39)}
                        {VARIABLE_OP spawn_y rand (88..91)}
                        [unit]
                            type=$spawn_type
                            x,y=$spawn_x,$spawn_y
                            side=7
                            to_variable=blackening_store
                            generate_name=yes
                            random_traits=yes
                            random_gender=yes
                        [/unit]
                        {MAKE_BLACK_SOUL}
                        [clear_variable]
                            name=blackening_store
                        [/clear_variable]
                    [/then]
                [/if]
            [/then]
        [/if]
    [/event]
    {RESET_FREE_SPAWNS 1}
[/scenario]

